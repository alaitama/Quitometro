<!doctype html>
<html>
<head>
<title>My Page</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<style type="text/css">
    .ui-icon-home
    {
        background: url('img/glyphicons_free/glyphicons/png/glyphicons_020_home.png') no-repeat rgba(0, 0, 0, 0.4) !important;
        //background-size: 16px 16px;
    }
    .ui-icon-settings
    {
        background: url('img/glyphicons_free/glyphicons/png/glyphicons_020_cog.png') no-repeat rgba(0, 0, 0, 0.4) !important;
        background-size: 16px 16px;
    }
    .ui-icon-stats
    {
        background: url('img/glyphicons_free/glyphicons/png/glyphicons_020_stats.png') no-repeat rgba(0, 0, 0, 0.4) !important;
        background-size: 16px 16px;
    }
    .ui-icon-info
    {
        background: url('img/glyphicons_free/glyphicons/png/glyphicons_020_info-sign.png') no-repeat rgba(0, 0, 0, 0.4) !important;
        background-size: 16px 16px;
    }
    
</style>



<link href="css/jquery.mobile-1.3.2.css" rel="stylesheet" type="text/css" />
<link href="css/jquery.mobile.theme-1.3.2.css" rel="stylesheet" type="text/css" />

<!--link href="css/jquery.mobile-1.4.0-rc.1.css" rel="stylesheet" type="text/css" />
<link href="css/jquery.mobile.theme-1.4.0-rc.1.css" rel="stylesheet" type="text/css" /-->

<link href="css/glyphicon.css" rel="stylesheet" type="text/css" />


<!-- ------JAVASCRIPTS------- -->
<!------------------------------>

<script src="js/jquery-1.10.2.js" type="text/javascript"></script>
<script src="js/jquery.mobile-1.3.2.js" type="text/javascript"></script>

<!--script src="js/jquery-1.10.2.js" type="text/javascript"></script>
<script src="js/jquery.mobile-1.4.0-rc.1.js" type="text/javascript"></script-->


<script src="cordova.js" type="text/javascript"></script>

</head>
<body>
    
    
    <!-- PAGE SETTINGS -->
    <div id="settingsPage" data-role="page" data-theme="a" data-transition="slide" >
        
        <div data-role="content">
            <label for="datequit">Día que dejo de fumar:</label>
            <input id="datequit" name="datequit" class="nativedatepicker" placeholder="dd/MM/yyyy" value="" type="date" readonly>
            <label for="timequit">Hora que dejo de fumar:</label>
            <input id="timequit" name="timequit" class="nativetimepicker" id="timequit" placeholder="hh:mm" value="" type="time" readonly><!--readonly-->
            <label for="numcigs">Número de cigarros diarios:</label>
            <input name="numcigs" id="numcigs" placeholder="" value="" type="number">
            <label for="numcigpaq">Número de cigarros paquete :</label>
            <input name="numcigpaq" id="numcigpaq" placeholder="" value="20" type="number">
            <label for="precio">Precio paquete:</label>
            <input name="precio" id="precio" placeholder="" value="" type="number">
        </div>            
        
        <!-- NAVBAR MENU -->
        <div data-role="footer" data-position="fixed" data-tap-toggle="false" data-transition="slide"> <!--data-fullscreen="true"-->
            <div data-role="navbar" data-iconpos="top">
               <ul>
                   <li><a id="#navHome" href="index.html" data-transition="none" data-direction="reverse">
                       <span class="glyphicon glyphicon-home"></span><br/>
                       <span class="ui-btn-text">Inicio</span>
                    </a></li>
                   <li><a id="#navSettings" href="settings.html" data-transition="none" class="ui-btn-active ui-state-persist">
                       <span class="glyphicon glyphicon-cog"></span><br/>
                       <span class="ui-btn-text">Configuracion</span>
                    </a></li>
                   <li><a href="stats.html">
                       <span class="glyphicon glyphicon-stats"></span><br/>
                       <span class="ui-btn-text">Progresos</span>
                    </a></li>
                   <li><a href="about.html" data-transition="none">
                       <span class="glyphicon glyphicon-info-sign"></span><br/>
                       <span class="ui-btn-text">Info</span>
                    </a></li>
                </ul>
            </div><!-- /navbar -->
        </div><!-- /footer -->
        <!-- FIN NAVBAR MENU -->
        
    </div>
    <!-- FIN PAGE SETTINGS -->
    
    

<script type="text/javascript">
    
    $('.nativedatepicker').focus(function(event) {
        
        var currentField = $(this);
        var myNewDate = Date.parse(currentField.val()) || new Date();
        
        if(typeof myNewDate === "number"){ myNewDate = new Date (myNewDate); } 
               
        // Same handling for iPhone and Android
        window.plugins.datePicker.show({
            date : myNewDate,
            mode : 'date', // date or time or blank for both
            allowOldDates : true
        }, function(returnDate) {
            var newDate = new Date(returnDate);
            //currentField.val(newDate.toString("dd/MM/yyyy"));
            currentField.val(newDate.getDate() + "/" + newDate.getMonth() + "/" + newDate.getFullYear());

            // This fixes the problem you mention at the bottom of this script with it not working a second/third time around, because it is in focus.
            currentField.blur();
        });
    });
    
    $('.nativetimepicker').focus(function(event) {
        var currentField = $(this);
        var time = currentField.val();
        var myNewTime = new Date();

        //if(typeof myNewTime === "number"){ myNewTime = new Date (myNewTime); } 
        
        myNewTime.setHours(time.substr(0, 2));
        myNewTime.setMinutes(time.substr(3, 2));

        // Same handling for iPhone and Android
        plugins.datePicker.show({
            date : myNewTime,
            mode : 'time', // date or time or blank for both
            allowOldDates : true
        }, function(returnDate) {
          // returnDate is generated by .toLocaleString() in Java so it will be relative to the current time zone
            var newDate = new Date(returnDate);
            //currentField.val(newDate.toString("HH:mm"));
            currentField.val(newDate.getHours() + ":" + newDate.getMinutes());

            currentField.blur();
        });
    });
    
    $('#navHome').click(function() {
        $('#home').load('menu.html');
    });
    
</script>

<script type="text/javascript">
    
    $( "#datequit" ).change(function() {
        // Check input( $( this ).val() ) for validity here
        sessionStorage.setItem("dSinFumar", getDateQuit($(this)));
        
        updateContadores();
    });
    
    function getDateQuit(currentField) {
        //var currentField = $(this);
        var sQuit = currentField.val();
        console.log(sQuit);
        var dQuit = new Date();
        dQuit.setDate(Number(sQuit.substr(0,2)));
        //window.alert(sQuit.substr(3,2));
        dQuit.setMonth(Number(sQuit.substr(3,2))-1);
        dQuit.setFullYear(sQuit.substr(6,4));
        
        return dQuit;
        
    };
    
    
    $( "#timequit" ).change(function() {
        // Check input( $( this ).val() ) for validity here
        sessionStorage.setItem("tSinFumar", getTimeQuit($(this)));
        
        updateContadores();
    });
    
    function getTimeQuit(currentField) {
        //var currentField = $(this);
        var sQuit = currentField.val();
        console.log(sQuit);
        var tQuit = new Date();
        tQuit.setHours(sQuit.substr(0,2));
        tQuit.setMinutes(sQuit.substr(3,2));
        
        return tQuit;
    };
    
    $( "#numcigs" ).change(function() {
        // Check input( $( this ).val() ) for validity here
        sessionStorage.setItem("nCigarros", $(this).val());
        
        updateContadores();
    });
    
    $( "#numcigpaq" ).change(function() {
        // Check input( $( this ).val() ) for validity here
        sessionStorage.setItem("nCigarrosPaquete", $(this).val());
        
        updateContadores();
    });
    
    $( "#precio" ).change(function() {
        // Check input( $( this ).val() ) for validity here
        sessionStorage.setItem("nPrecio", $(this).val());
        
        updateContadores();
    });
    
    /*
        	var dTemp = new Date(2013,4,24,14,00);
			sessionStorage.setItem("dSinFumar", dTemp);
			sessionStorage.setItem("nCigarros", 10);
			sessionStorage.setItem("nCigarrosPaquete", 20);
			sessionStorage.setItem("nPrecio", 4.50);
			
    */
    
    function loadContadores() {
        
        var dSinFumar = sessionStorage.getItem("dSinFumar");
		//dSinFumar = new Date(dSinFumar);
		var nCigarros = sessionStorage.getItem("nCigarros");
		var nCigarrosPaquete = sessionStorage.getItem("nCigarrosPaquete");
		var nPrecio = sessionStorage.getItem("nPrecio");
        
        if(dSinFumar!=undefined && dSinFumar!=null) {
            $('#datequit').val(dSinFumar.getDate() + "/" + dSinFumar.getMonth()+1 + "/" + dSinFumar.getFullYear());
        }
            
    }
    
    
    function updateContadores() {
			
            var dSinFumar = sessionStorage.getItem("dSinFumar");
			dSinFumar = new Date(dSinFumar);
			var nCigarros = sessionStorage.getItem("nCigarros");
			var nCigarrosPaquete = sessionStorage.getItem("nCigarrosPaquete");
			var nPrecio = sessionStorage.getItem("nPrecio");
			
            console.log("Fecha cargada:" + dSinFumar.toString());
            
            
			var dHoy = new Date();
            console.log("Fecha de hoy:" + dHoy.toString());
            
			var timeDiff =(dHoy.getTime() - dSinFumar.getTime()); //diferencia en ms
			//dDiff = new Date(nDiff);
            var nDiff = Math.floor(timeDiff / (1000 * 3600 * 24)); 
			var dDiff = new Date(timeDiff);
            
			var seconds = dDiff.getSeconds();
			var minutes = dDiff.getMinutes();
			var hour = dDiff.getHours();
			var year = dDiff.getFullYear();
			var month = dDiff.getMonth(); // beware: January = 0; February = 1, etc.
			var day = dDiff.getDate();
			
			//Calculo de cigarros dejados de fumar
			var nCigSegs = nCigarros / (24*60*60);
			console.log(dDiff.getTime());
			
			$('#dSinFumar').html(nDiff + "d " + hour + "h " + minutes + "m ");
			$('#nCigs').html((nDiff/1000)*nCigSegs);
			$('#nDinero').html(nCigarrosPaquete);
    };
    
    $( "#homePage" ).on( "pagebeforeshow", function( event, data ) {
        // Let the framework know we're going to handle the load.
        //event.preventDefault();
        // ... load the document then insert it into the DOM ...
        // at some point, either in this callback, or through
        // some other async means, call resolve, passing in
        // the following args, plus a jQuery collection object
        // containing the DOM element for the page.
        updateContadores();
        
        //data.deferred.resolve( data.absUrl, data.options, page );
    });
    
    
    $( "#settingsPage" ).on( "pagebeforeshow", function( event, data ) {
        // Let the framework know we're going to handle the load.
        //event.preventDefault();
        // ... load the document then insert it into the DOM ...
        // at some point, either in this callback, or through
        // some other async means, call resolve, passing in
        // the following args, plus a jQuery collection object
        // containing the DOM element for the page.
        console.log("Inside settingsLALALALAAL");
        
        loadContadores();
        
        //data.deferred.resolve( data.absUrl, data.options, page );
    });
			
			
</script>

</body>
</html>
