<!DOCTYPE html>
<!--
    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
     KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.
-->
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <!--meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" /-->
		<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height" />
        
        <!--link rel="stylesheet" type="text/css" href="css/index.css" /-->
        <link href="css/jquery.mobile-1.3.2.css" rel="stylesheet" type="text/css" />
		<link href="css/jquery.mobile.theme-1.3.2.css" rel="stylesheet" type="text/css" />
		<link href="css/glyphicon.css" rel="stylesheet" type="text/css" />

        
        <script type="text/javascript" src="js/jquery-1.10.2.js"></script>
        <script type="text/javascript" src="js/jquery.mobile-1.3.2.js"></script>
        
         <link rel="stylesheet" type="text/css" href="css/tolito-1.0.6.css" />
         <script type="text/javascript" src="js/tolito-1.0.6.js"></script>
        
        
        <title>Quitometro</title>
    </head>
    <body onload="onLoad()">
		
		
<!-------------------------------------------------------------------------------------->

		<!-- PAGE HOME -->
		<div id="homePage" data-role="page" data-theme="a">
    
			<div data-role="header" data-position="fixed">
				<h1>Quitómetro</h1>
			</div><!-- /header -->
			
			<div data-role="content">
				<!--
				<ul class="ui-listview ui-listview-inset ui-corner-all ui-shadow" data-inset="true" data-role="listview">
					<li class="ui-li ui-li-divider ui-bar-a ui-first-child" data-form="ui-bar-a" data-theme="a" data-swatch="a" data-role="list-divider" role="heading">Tiempo sin fumar:</li>
					<li id="dSinFumar" class="ui-li ui-li-static ui-btn-up-c ui-first-child"><h3>123d 50h</h3></li>
				</ul>
				
				 <ul class="ui-listview ui-listview-inset ui-corner-all ui-shadow" data-inset="true" data-role="listview">
					<li class="ui-li ui-li-divider ui-bar-a ui-first-child" data-form="ui-bar-a" data-theme="a" data-swatch="a" data-role="list-divider" role="heading">Cigarros no fumados:</li>
					<li id="nCigs" class="ui-li ui-li-static ui-btn-up-c ui-first-child"><h2>123</h2></li>
				</ul>
				
				 <ul class="ui-listview ui-listview-inset ui-corner-all ui-shadow" data-inset="true" data-role="listview">
					<li class="ui-li ui-li-divider ui-bar-a ui-first-child" data-form="ui-bar-a" data-theme="a" data-swatch="a" data-role="list-divider" role="heading">Dinero ahorrado:</li>
					<li id="nDinero" class="ui-li ui-li-static ui-btn-up-c ui-last-child"><h1>123</h1></li>
				</ul>
				-->
				
				Día que dejo de fumar:
				<div id="totalDateQuit" class="ui-li ui-li-static ui-corner-all ui-btn-up-c ui-last-child" style="font-size: 16pt;">00/00/0000</div>
				<br/>
				Tiempo sin fumar:
				<div id="totalTimeQuit" class="ui-li ui-li-static ui-corner-all ui-btn-up-c ui-last-child" style="font-size: 16pt;">0d 0h 0m</div>
				<br/>
				Cigarros no fumados:
				<div id="totalCigs" class="ui-li ui-li-static ui-corner-all ui-btn-up-c ui-last-child" style="font-size: 16pt;">0</div>
				<br/>
				Dinero ahorrado:
				<div id="totalMoney" class="ui-li ui-li-static ui-corner-all ui-btn-up-c ui-last-child" style="font-size: 16pt;">0</div>
				<br/>
				
			</div>

			<div data-role="footer" data-position="fixed" data-tap-toggle="false"> <!--data-fullscreen="true"-->
				<div data-role="navbar" data-iconpos="top">
				   <ul>
					   <li><a id="#navHome" href="#homePage" class="ui-btn-active ui-state-persist">
						   <span class="glyphicon glyphicon-home"></span><br/>
						   <span class="ui-btn-text">Inicio</span>
						</a></li>
					   <li><a href="#settingsPage" data-transition="none">
						   <span class="glyphicon glyphicon-cog"></span><br/>
						   <span class="ui-btn-text">Configuracion</span>
						</a></li>
					   <li><a href="#statsPage" data-transition="none">
						   <span class="glyphicon glyphicon-stats"></span><br/>
						   <span class="ui-btn-text">Progresos</span>
						</a></li>
					   <li><a href="#aboutPage" data-transition="none">
						   <span class="glyphicon glyphicon-info-sign"></span><br/>
						   <span class="ui-btn-text">Info</span>
						</a></li>
					</ul>
				</div><!-- /navbar -->
			</div><!-- /footer -->
		</div><!-- /page -->
		<!-- FIN PAGE HOME --> 
		
<!-------------------------------------------------------------------------------------->
<!-------------------------------------------------------------------------------------->
		
		<!-- PAGE SETTINGS -->
		<div id="settingsPage" data-role="page" data-theme="a" data-transition="slide" >	
			
			<div data-role="content">
				<label for="dateQuit">Día que dejo de fumar:</label>
				<input name="dateQuit" id="dateQuit" class="nativedatepicker" value="" readonly  type="text" /> <!--type="date" placeholder="dd/MM/yyyy" -->
				<label for="timeQuit">Hora que dejo de fumar:</label>
				<input name="timeQuit" id="timeQuit" class="nativetimepicker"  value="" readonly type="text" /> <!--type="time" placeholder="hh:mm" readonly-->
				<label for="nCigs">Número de cigarros diarios:</label>
				<input name="nCigs" id="nCigs" placeholder="" value="" type="number" />
				<label for="nCigPaq">Número de cigarros paquete :</label>
				<input name="nCigPaq" id="nCigPaq" placeholder="" value="" type="number" />
				<label for="nPricePaq">Precio paquete(€):</label>
				<input name="nPricePaq" id="nPricePaq" placeholder="" value="" type="number" />
				
			</div>            
			
			<!-- NAVBAR MENU -->
			<div data-role="footer" data-position="fixed" data-tap-toggle="false" data-transition="slide"> <!--data-fullscreen="true"-->
				<div data-role="navbar" data-iconpos="top">
				   <ul>
					   <li><a id="#navHome" href="#homePage" data-transition="none">
						   <span class="glyphicon glyphicon-home"></span><br/>
						   <span class="ui-btn-text">Inicio</span>
						</a></li>
					   <li><a href="#settingsPage" class="ui-btn-active ui-state-persist">
						   <span class="glyphicon glyphicon-cog"></span><br/>
						   <span class="ui-btn-text">Configuracion</span>
						</a></li>
					   <li><a href="#statsPage" data-transition="none">
						   <span class="glyphicon glyphicon-stats"></span><br/>
						   <span class="ui-btn-text">Progresos</span>
						</a></li>
					   <li><a href="#aboutPage" data-transition="none">
						   <span class="glyphicon glyphicon-info-sign"></span><br/>
						   <span class="ui-btn-text">Info</span>
						</a></li>
					</ul>
				</div><!-- /navbar -->
			</div><!-- /footer -->
			<!-- FIN NAVBAR MENU -->
			
		</div>
		<!-- FIN PAGE SETTINGS -->
		
<!-------------------------------------------------------------------------------------->
<!-------------------------------------------------------------------------------------->
		
		<!-- PAGE STATISTICS -->
		<div id="statsPage" data-role="page" data-theme="a">

			<!--div data-role="header">
				<h1>Estadísticas</h1>
			</div--><!-- /header -->
			
			<ul data-role="listview">
				<li>
					La tensión arterial y el pulso se normalizan y se incrementa el flujo sanguíneo(20 minutos)
					<div id="pb1"></div>
				</li>
				<li>
					El monóxido de carbono y la nicotina han desaparecido por completo(48 horas)
					<div id="pb2"></div>
				</li>
				<li>
					Menos mucosidad en la garganta y los bronquios. Menores dificultades respiratorias(2-3 días)
					<div id="pb3"></div>
				</li>
				<li>
					Mejoran los sentidos del olfato y el gusto. Los dientes están más limpios y el nivel de energía aumenta(5-7 días)
					<div id="pb4"></div>
				</li>
				<li>
					El síndrome de abstinencia físico desaparece. Disminuye asimismo el riesgo de trombosis(2-3 semanas)
					<div id="pb5"></div>
				</li>
				<li>
					La tos desaparece. Disminuyen los problemas de falta de aliento. Más energía. Los pulmones son más fuertes ante una infección(3-4 semanas)
					<div id="pb6"></div>
				</li>
				<li>
					La función pulmonar mejora un 5%(2-3 meses)
					<div id="pb7"></div>
				</li>
				<li>
					Se divide por dos el riesgo de padecer enfermedades cardiovasculares(1 año)
					<div id="pb8"></div>
				</li>
				<li>
					Los riesgos de padecer neumonía o gripe son los mismos que los de un no fumador(2-3 años)
					<div id="pb9"></div>
				</li>
				<li>
					El riesgo de cáncer de garganta, esófago y vejiga se reduce a la mitad(5 años)
					<div id="pb10"></div>
				</li>
				<li>
					Los riesgos de enfermedades cardiovasculares o trombosis son los mismos que los de los no fumadores(5-10 años)
					<div id="pb11"></div>
				</li>
				<li>
					El riesgo de cáncer de pulmón se divide por dos(10 años)
					<div id="pb12"></div>
				</li>
				<li>
					El riesgo de padecer cáncer de pulmón, garganta, esófago o vejiga es el mismo que el de los no fumadores(15-20 años)
					<div id="pb13"></div>
				</li>
			</ul>
	
			<!-- NAVBAR MENU -->
			<div data-role="footer" data-position="fixed" data-tap-toggle="false" data-transition="slide"> <!--data-fullscreen="true"-->
				<div data-role="navbar" data-iconpos="top">
				   <ul>
					   <li><a id="#navHome" href="#homePage" data-transition="none">
						   <span class="glyphicon glyphicon-home"></span><br/>
						   <span class="ui-btn-text">Inicio</span>
						</a></li>
					   <li><a href="#settingsPage" data-transition="none">
						   <span class="glyphicon glyphicon-cog"></span><br/>
						   <span class="ui-btn-text">Configuracion</span>
						</a></li>
					   <li><a href="#statsPage" class="ui-btn-active ui-state-persist">
						   <span class="glyphicon glyphicon-stats"></span><br/>
						   <span class="ui-btn-text">Progresos</span>
						</a></li>
					   <li><a href="#aboutPage" data-transition="none">
						   <span class="glyphicon glyphicon-info-sign"></span><br/>
						   <span class="ui-btn-text">Info</span>
						</a></li>
					</ul>
				</div><!-- /navbar -->
			</div><!-- /footer -->
			<!-- FIN NAVBAR MENU -->
		</div>
		<!-- FIN PAGE STATISCTICS -->

<!-------------------------------------------------------------------------------------->
<!-------------------------------------------------------------------------------------->
		
		<!-- PAGE ABOUT -->
		<div id="aboutPage" data-role="page" data-theme="a">
    
			<!--div data-role="header" data-position="fixed">
				<h1>Quitometro</h1>
			</div--><!-- /header -->
			
			<div data-role="content">
				<h2>¿Para que sirve Quitometro?</h2>
				
				Calcula el tiempo que llevas sin fumar, los cigarros no fumados, y el dinero ahorrado 
				desde que dejaste de fumar.
				
				<h2>¿Cómo configurar Quitometro?</h2>
				
				Para configurar la aplicacion solo tienes que clicar en la opción <strong>Configuración</strong> 
				e introducir la fecha y hora en que dejaste de fumar, el número de cigarros fumados al día, 
				el número de cigarros en una cajetilla y el precio de una cajetilla. Automáticamente los valores 
				son guardados. Ves a la pantalla <strong>Inicio</strong> para ver la nueva información.
				
				<h2>Licencia</h2>
				
				Quitometro es de código libre. Puedes ver el código fuente y la licencia en <strong>https://github.com/ramsys/Quitometro</strong>
				<br/><br/>
				No se da ninguna garantía con el producto.
				
				
				<h2>Autor</h2>
				
				Alberto LM
				
				<br/><br/>
				
				Esta aplicación esta hecha sin fines de lucro, me ha servido para aprender las técnologias web 
				integradas en el movil. Pero puedes invitarme a un café si te apetece.
				
				<button>Invitar a café</button>
				
			</div>

			<!-- NAVBAR MENU -->
			<div data-role="footer" data-position="fixed" data-tap-toggle="false" data-transition="slide"> <!--data-fullscreen="true"-->
				<div data-role="navbar" data-iconpos="top">
				   <ul>
					   <li><a id="#navHome" href="#homePage" data-transition="none">
						   <span class="glyphicon glyphicon-home"></span><br/>
						   <span class="ui-btn-text">Inicio</span>
						</a></li>
					   <li><a href="#settingsPage" data-transition="none">
						   <span class="glyphicon glyphicon-cog"></span><br/>
						   <span class="ui-btn-text">Configuracion</span>
						</a></li>
					   <li><a href="#statsPage" data-transition="none">
						   <span class="glyphicon glyphicon-stats"></span><br/>
						   <span class="ui-btn-text">Progresos</span>
						</a></li>
					   <li><a href="#aboutPage" class="ui-btn-active ui-state-persist">
						   <span class="glyphicon glyphicon-info-sign"></span><br/>
						   <span class="ui-btn-text">Info</span>
						</a></li>
					</ul>
				</div><!-- /navbar -->
			</div><!-- /footer -->
			<!-- FIN NAVBAR MENU -->
			
		</div><!-- /page -->
		<!-- FIN PAGE ABOUT -->

<!-------------------------------------------------------------------------------------->
        
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/utils.js"></script>
		<script type="text/javascript" src="js/quitometro.js"></script>
		
		<script type="text/javascript">
    
			// Wait for Cordova to load
			//
			//document.addEventListener("deviceready", onDeviceReady, false);

			// Cordova is ready
			//
			window.storage = window.localStorage;
			
			/*
			function onDeviceReady() {
				storage = window.localStorage;
			}
			*/
			
			$( "#dateQuit" ).focusout(function() {
				// Check input( $( this ).val() ) for validity here
				var currentVal = $(this).val();

				if(currentVal != "") {
					var dQuit = getDateFromString(currentVal);
					storage.setItem("dQuit", dQuit);
				}
				
			});
			
			
			$( "#timeQuit" ).focusout(function() {
				// Check input( $( this ).val() ) for validity here
				var currentVal = $(this).val();
				
				if(currentVal != "") {
					var tQuit = getTimeFromString(currentVal);
					storage.setItem("tQuit", tQuit);
				}
			});
			
			$( "#nCigs" ).change(function() {
				// Check input( $( this ).val() ) for validity here
				var currentVal = $(this).val();
				
				if(currentVal != "") {
					storage.setItem("nCigs", $(this).val());
				}

			});
			
			$( "#nCigPaq" ).change(function() {
				// Check input( $( this ).val() ) for validity here
				var currentVal = $(this).val();
				
				if(currentVal != "") {
					storage.setItem("nCigPaq", $(this).val());
				}

			});
			
			$( "#nPricePaq" ).change(function() {
				// Check input( $( this ).val() ) for validity here
				var currentVal = $(this).val();
				
				if(currentVal != "") {
					storage.setItem("nPricePaq", $(this).val());
				}
			});
			
			/*
				var dTemp = new Date(2013,4,24,14,00);
				storage.setItem("dSinFumar", dTemp);
				storage.setItem("nCigarros", 10);
				storage.setItem("nCigarrosPaquete", 20);
				storage.setItem("nPrecio", 4.50);			
			*/
			
			function loadContadores() {
				
				var dQuit = storage.getItem("dQuit");
				if(dQuit != null)
					dQuit = new Date(dQuit);
				var tQuit = storage.getItem("tQuit");
				if(tQuit != null)
					tQuit = new Date(tQuit);
				var nCigs = storage.getItem("nCigs");
				var nCigPaq = storage.getItem("nCigPaq");
				var nPicePaq = storage.getItem("nPricePaq");
				
				if(dQuit!=undefined && dQuit!=null) {
					$('#dateQuit').val(formatDateToString(dQuit));
				}
				if(tQuit!=undefined && tQuit!=null) {
					$('#timeQuit').val(formatTimeToString(tQuit));
				}
				if(nCigs!=undefined && nCigs!=null) {
					$('#nCigs').val(nCigs);
				}
				if(nCigPaq!=undefined && nCigPaq!=null) {
					$('#nCigPaq').val(nCigPaq);
				}
				if(nPicePaq!=undefined && nPicePaq!=null) {
					$('#nPricePaq').val(nPicePaq);
				}
						
			}
			
			
			function updateContadores() {
									
				var dQuit = storage.getItem("dQuit");
				if(dQuit != null)
					dQuit = new Date(dQuit);
				var tQuit = storage.getItem("tQuit");
				if(tQuit != null)
					tQuit = new Date(tQuit);
				var nCigs = storage.getItem("nCigs");
				var nCigPaq = storage.getItem("nCigPaq");
				var nPricePaq = storage.getItem("nPricePaq");
								
				//console.log("Fecha cargada:" + dSinFumar.toString());
				//var d=Date.parse("March 21, 2012");
				var minutes=1000*60;
				var hours=minutes*60;
				var days=hours*24;
				var months=days*30;
				var years=days*365;

				//var y=Math.round(d/years);
					
				var dHoy = new Date();
				//console.log("Fecha de hoy:" + dHoy.toString());
				
				if(dQuit != null) {
					if(tQuit != null) {
						dQuit.setHours(tQuit.getHours());
						dQuit.setMinutes(tQuit.getMinutes());
					}
					
					var timeDiff =(dHoy.getTime() - dQuit.getTime()); //diferencia en ms
					var staticTimeDiff = timeDiff;
					/*
					console.log("Time ms: " + timeDiff);
					console.log("Year: " + Math.floor(timeDiff/years));
					console.log("Month: " + Math.floor(timeDiff/months));
					console.log("Days: " + Math.floor(timeDiff/days));
					console.log("Hours: " + Math.floor(timeDiff/hours));
					console.log("Mins: " + Math.floor(timeDiff/minutes));
					*/
					var diffYear = Math.floor(timeDiff/years);
					timeDiff = timeDiff - (years * diffYear);
					var diffMonth = Math.floor(timeDiff/months);
					timeDiff = timeDiff - (months * diffMonth);
					var diffDay = Math.floor(timeDiff/days);
					timeDiff = timeDiff - (days * diffDay);
					var diffHours = Math.floor(timeDiff/hours);
					timeDiff = timeDiff - (hours * diffHours);
					var diffMins = Math.floor(timeDiff/minutes);
					/*
					console.log("Year: " + diffYear);
					console.log("Month: " + diffMonth);
					console.log("Days: " + diffDay);
					console.log("Hours: " + diffHours);
					console.log("Mins: " + diffMins);
					*/
					var sTotalQuit = "";
					if(diffMins > 0) {
						sTotalQuit = diffMins + "m";
					}
					if(diffHours > 0) {
						sTotalQuit = diffHours + "h " + sTotalQuit;
					}
					if(diffDay > 0) {
						var sDia = "días ";
						if(diffDay == 1)
							sDia = "día ";
						sTotalQuit = diffDay + sDia + sTotalQuit;
					}
					if(diffMonth >0 ) {
						var sMes = "meses ";
						if(diffMonth == 1)
							sMes = "mes ";
						sTotalQuit = diffMonth + sMes + sTotalQuit;
					}
					if(diffYear > 0) {
						sAno = "años ";
						if(diffYeas == 1)
							sAno = "año ";
						sTotalQuit = diffYear + sAno + sTotalQuit;
					}
					if(sTotalQuit == "") {
						sTotalQuit = "0h 0m";
					}
					
					
					
					//Calculo de cigarros dejados de fumar
					var nTotalCigs = nCigs * (staticTimeDiff / days);
					var nTotalCigs = Math.floor(nTotalCigs);
					//console.log("nTotalCigs: " + nTotalCigs);
					
					//Calculo de dinero
					var nTotalMoney = 0;
					if(nTotalCigs > 0) {
						nTotalMoney = (nTotalCigs / nCigPaq) * nPricePaq;
						nTotalMoney = Math.round(nTotalMoney * 100) / 100
						//console.log(nTotalCigs + "/" + nCigPaq + "*" + nPricePaq);
					}
					
					
					$('#totalDateQuit').html(formatDateToString(dQuit));
					$('#totalTimeQuit').html(sTotalQuit);
					$('#totalCigs').html(nTotalCigs);
					$('#totalMoney').html(nTotalMoney + " <span class='glyphicon glyphicon-euro' />");
				}
			};
			
			$( "#homePage" ).on( "pagebeforeshow", function( event, data ) {
				// Let the framework know we're going to handle the load.
				//event.preventDefault();
				// ... load the document then insert it into the DOM ...
				// at some point, either in this callback, or through
				// some other async means, call resolve, passing in
				// the following args, plus a jQuery collection object
				// containing the DOM element for the page.
				updateContadores();
				
				//data.deferred.resolve( data.absUrl, data.options, page );
			});
			
			
			$( "#settingsPage" ).on( "pagebeforeshow", function( event, data ) {
				// Let the framework know we're going to handle the load.
				//event.preventDefault();
				// ... load the document then insert it into the DOM ...
				// at some point, either in this callback, or through
				// some other async means, call resolve, passing in
				// the following args, plus a jQuery collection object
				// containing the DOM element for the page.

				loadContadores();
				
				//data.deferred.resolve( data.absUrl, data.options, page );
			});
			
			$( "#statsPage" ).on( "pagebeforeshow", function( event, data ) {
				// Let the framework know we're going to handle the load.
				//event.preventDefault();
				// ... load the document then insert it into the DOM ...
				// at some point, either in this callback, or through
				// some other async means, call resolve, passing in
				// the following args, plus a jQuery collection object
				// containing the DOM element for the page.
				
				loadStatistics();
			});
								
								
		</script>
        
    </body>
</html>
